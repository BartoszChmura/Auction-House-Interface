<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Lista Przedmiotów</title>
    <link rel="stylesheet" href="/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <%- include('partials/navbar') %>
    <h1>Przedmioty na aukcji</h1>
    <div id="itemsList"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const jwt = localStorage.getItem('jwt');
            axios.get('http://localhost:8080/item/all', {
                headers: {
                    'Authorization': 'Bearer ' + jwt
                }
            }).then(function(response) {
                const items = response.data;
                const list = document.getElementById('itemsList');
                items.forEach(item => {
                    const winnerText = item.winnerId ? item.winnerId : "brak";
                    const itemDiv = document.createElement('div');
                    itemDiv.innerHTML = `
                        <h2>${item.title}</h2>
                        <p>${item.description}</p>
                        <ul>
                            <li>Aktualna cena: ${item.currentPrice} zł</li>
                            <li>ID zwycięzcy: ${winnerText}</li>
                            <li>Kategoria: ${item.categoryName}</li>
                            <li>Data rozpoczęcia: ${formatDate(item.startTime)}</li>
                            <li>Data zakończenia: ${formatDate(item.endTime)}</li>
                            <li>Status: ${item.status}</li>
                        </ul>
                    `;
                    list.appendChild(itemDiv);
                });
            }).catch(function(error) {
                console.error('Failed to fetch items:', error);
                alert('Błąd przy ładowaniu przedmiotów');
            });
        });
        
        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit' };
            return new Date(dateString).toLocaleDateString('pl-PL', options);
        }
        </script>
</body>
</html>
